import{a as H}from"./chunk-KTMMHDL6.js";import{a as te}from"./chunk-6GTLZV4K.js";import{a as z}from"./chunk-SRPTWKHW.js";import{a as P}from"./chunk-EHDXVZQM.js";import{a as c}from"./chunk-LOWC4Y7I.js";import{a as R}from"./chunk-UBHQMGET.js";import{a as F}from"./chunk-EDZQSM3T.js";import{a as w}from"./chunk-PJGSCWXZ.js";import{a as v}from"./chunk-NUC3LT2W.js";function Pe(){return!0}function Fe(e,i){i=R(i,"This object was destroyed, i.e., destroy() was called.");function r(){throw new w(i)}for(var o in e)typeof e[o]=="function"&&(e[o]=r);e.isDestroyed=Pe}var k=Fe;var re={STREAM_DRAW:P.STREAM_DRAW,STATIC_DRAW:P.STATIC_DRAW,DYNAMIC_DRAW:P.DYNAMIC_DRAW,validate:function(e){return e===re.STREAM_DRAW||e===re.STATIC_DRAW||e===re.DYNAMIC_DRAW}},K=re;var ye={Texture:0,Geometry:1};function Q(){this._memoryByType={}}Q.prototype.allocateGPUMemory=function(e,i){let r=this._memoryByType[e];r||(r=this._memoryByType[e]=0),r+=i,this._memoryByType[e]=r};Q.prototype.releaseGPUMemory=function(e,i){let r=this._memoryByType[e];r==null&&(r=this._memoryByType[e]=0),r-=i,r<0&&(console.log("memory cant less than 0."),r=0),this._memoryByType[e]=r};Q.prototype.reset=function(){this._memoryByType={}};function X(){this._owners={},this.show=!1}X.prototype.allocateGPUMemory=function(e,i,r){if(!this.show)return;let o=this._owners[i];o||(o=this._owners[i]=new Q),o.allocateGPUMemory(e,r)};X.prototype.releaseGPUMemory=function(e,i,r){if(!this.show)return;let o=this._owners[i];o||(o=this._owners[i]=new Q),o.releaseGPUMemory(e,r)};X.prototype.reset=function(){this._owners={}};X.prototype.isDestroyed=function(){return!1};X.prototype.destroy=function(){return k(this)};function q(e){if(e=R(e,R.EMPTY_OBJECT),F.defined("options.context",e.context),!v(e.typedArray)&&!v(e.sizeInBytes))throw new w("Either options.sizeInBytes or options.typedArray is required.");if(v(e.typedArray)&&v(e.sizeInBytes))throw new w("Cannot pass in both options.sizeInBytes and options.typedArray.");if(v(e.typedArray)&&(F.typeOf.object("options.typedArray",e.typedArray),F.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!K.validate(e.usage))throw new w("usage is invalid.");var i=e.context._gl,r=e.bufferTarget,o=e.typedArray,a=e.sizeInBytes,n=e.usage,t=v(o);t&&(a=o.byteLength),F.typeOf.number.greaterThan("sizeInBytes",a,0);var f=i.createBuffer();i.bindBuffer(r,f),i.bufferData(r,t?o:a,n),i.bindBuffer(r,null),this._gl=i,this._webgl2=e.context._webgl2,this._bufferTarget=r,this._sizeInBytes=a,this._usage=n,this._buffer=f,this.context=e.context,e.context.memorySize+=a,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(ye.Geometry,e.owner,a)}Object.defineProperties(q.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});q.prototype._getBuffer=function(){return this._buffer};q.prototype.copyFromArrayView=function(e,i){i=R(i,0),F.defined("arrayView",e),F.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",i+e.byteLength,this._sizeInBytes);var r=this._gl,o=this._bufferTarget;r.bindBuffer(o,this._buffer),r.bufferSubData(o,i,e),r.bindBuffer(o,null)};q.prototype.copyFromBuffer=function(e,i,r,o){if(!this._webgl2)throw new w("A WebGL 2 context is required.");if(!v(e))throw new w("readBuffer must be defined.");if(!v(o)||o<=0)throw new w("sizeInBytes must be defined and be greater than zero.");if(!v(i)||i<0||i+o>e.sizeInBytes)throw new w("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!v(r)||r<0||r+o>this._sizeInBytes)throw new w("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e.buffer&&(r>=i&&r<i+o||i>r&&i<r+o))throw new w("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===P.ELEMENT_ARRAY_BUFFER&&e.bufferTarget!==P.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==P.ELEMENT_ARRAY_BUFFER&&e.bufferTarget===P.ELEMENT_ARRAY_BUFFER)throw new w("Can not copy an index buffer into another buffer type.");var a=P.COPY_READ_BUFFER,n=P.COPY_WRITE_BUFFER,t=this._gl;t.bindBuffer(n,this._buffer),t.bindBuffer(a,e.buffer),t.copyBufferSubData(a,n,i,r,o),t.bindBuffer(n,null),t.bindBuffer(a,null)};q.prototype.getBufferData=function(e,i,r,o){if(i=R(i,0),r=R(r,0),!this._webgl2)throw new w("A WebGL 2 context is required.");if(!v(e))throw new w("arrayView is required.");var a,n,t=e.byteLength;if(v(o)?(a=o,v(t)?n=1:(t=e.length,n=e.BYTES_PER_ELEMENT)):v(t)?(a=t-r,n=1):(t=e.length,a=t-r,n=e.BYTES_PER_ELEMENT),r<0||r>t)throw new w("destinationOffset must be greater than zero and less than the arrayView length.");if(r+a>t)throw new w("destinationOffset + length must be less than or equal to the arrayViewLength.");if(i<0||i>this._sizeInBytes)throw new w("sourceOffset must be greater than zero and less than the buffers size.");if(i+a*n>this._sizeInBytes)throw new w("sourceOffset + length must be less than the buffers size.");var f=this._gl,u=P.COPY_READ_BUFFER;f.bindBuffer(u,this._buffer),f.getBufferSubData(u,i,e,r,o),f.bindBuffer(u,null)};q.prototype.isDestroyed=function(){return!1};q.prototype.destroy=function(){return!this.context._contextWasLost&&this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(ye.Geometry,this._ownerName,this.sizeInBytes),k(this)};var Ae=q;function Re(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=Math.random()*16|0,r=e==="x"?i:i&3|8;return r.toString(16)})}var ge=Re;function N(e){if(e=R(e,R.EMPTY_OBJECT),F.defined("options.context",e.context),!v(e.typedArray)&&!v(e.sizeInBytes))throw new w("Either options.sizeInBytes or options.typedArray is required.");if(v(e.typedArray)&&v(e.sizeInBytes))throw new w("Cannot pass in both options.sizeInBytes and options.typedArray.");v(e.typedArray)&&(F.typeOf.object("options.typedArray",e.typedArray),F.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),this._id=ge(),e.context.webgpu?this._inner=new e.context.webgpuMembers.BufferGPU(e):this._inner=new Ae(e),this.vertexArrayDestroyable=!0}N.createVertexBuffer=function(e){return F.defined("options.context",e.context),new N({context:e.context,bufferTarget:P.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,owner:e.owner})};N.createIndexBuffer=function(e){if(F.defined("options.context",e.context),!te.validate(e.indexDatatype))throw new w("Invalid indexDatatype.");if(e.indexDatatype===te.UNSIGNED_INT&&!e.context.elementIndexUint)throw new w("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var i=e.context,r=e.indexDatatype,o=te.getSizeInBytes(r),a=new N({context:i,bufferTarget:P.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:r,owner:e.owner}),n=a.sizeInBytes/o;return Object.defineProperties(a,{indexDatatype:{get:function(){return r}},bytesPerIndex:{get:function(){return o}},numberOfIndices:{get:function(){return n}}}),a};Object.defineProperties(N.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}},bufferTarget:{get:function(){return this._inner._bufferTarget}},buffer:{get:function(){return this._inner._buffer}}});N.prototype._getBuffer=function(){return this._inner._getBuffer()};N.prototype.copyFromArrayView=function(e,i){this._inner.copyFromArrayView(e,i)};N.prototype.copyFromBuffer=function(e,i,r,o){this._inner.copyFromBuffer(e,i,r,o)};N.prototype.getBufferData=function(e,i,r,o){this._inner.getBufferData(e,i,r,o)};N.prototype.isDestroyed=function(){return!1};N.prototype.destroy=function(){return this._inner.destroy(),k(this)};var xe=N;var Ne=function(){var e=!![];return function(i,r){var o=e?function(){if(r){var a=r.apply(i,arguments);return r=null,a}}:function(){};return e=![],o}}(),ce=Ne(void 0,function(){return ce.toString().search("(((.+)+)+)+$").toString().constructor(ce).search("(((.+)+)+)+$")});ce();function pe(){}pe.computeNeighbors=function(e,i){for(var r=e.length/3,o=new Uint32Array(i+1),a=new Uint32Array(i+1),n=function(I,g){I<g?o[I+1]++:a[g+1]++},t=0;t<r;t++){var f=e[3*t],u=e[3*t+1],s=e[3*t+2];n(f,u),n(u,s),n(s,f)}for(t=u=f=0;t<i;t++)s=o[t+1],n=a[t+1],o[t+1]=f,a[t+1]=u,f+=s,u+=n;for(var y=new Uint32Array(6*r),x=o[i],n=function(D,A,T){if(D<A){var B=o[D+1]++;y[2*B]=A,y[2*B+1]=T}else B=a[A+1]++,y[2*x+2*B]=D,y[2*x+2*B+1]=T},t=0;t<r;t++)f=e[3*t],u=e[3*t+1],s=e[3*t+2],n(f,u,t),n(u,s,t),n(s,f,t);for(f=function(I,g){var D=2*I;for(I=g-I,g=1;g<I;g++){var A=y[D+2*g],T=y[D+2*g+1],B=g-1;for(B;0<=B&&y[D+2*B]>A;B--)y[D+2*B+2]=y[D+2*B],y[D+2*B+3]=y[D+2*B+1];y[D+2*B+2]=A,y[D+2*B+3]=T}},t=0;t<i;t++)f(o[t],o[t+1]),f(x+a[t],x+a[t+1]);for(var p=new Int32Array(3*r),h=function(A,T){return A===e[3*T]?0:A===e[3*T+1]?1:A===e[3*T+2]?2:-1},r=function(A,T){A=h(A,T),p[3*T+A]=-1},f=function(A,T,B,O){A=h(A,T),p[3*T+A]=O,B=h(B,O),p[3*O+B]=T},t=0;t<i;t++){for(var u=o[t],s=o[t+1],n=a[t],l=a[t+1];u<s&&n<l;){var m=y[2*u],d=y[2*x+2*n];m===d?(f(t,y[2*u+1],d,y[2*x+2*n+1]),u++,n++):m<d?(r(t,y[2*u+1]),u++):(r(d,y[2*x+2*n+1]),n++)}for(;u<s;)r(t,y[2*u+1]),u++;for(;n<l;)d=y[2*x+2*n],r(d,y[2*x+2*n+1]),n++}return p};function Oe(e){--e;for(var i=1;32>i;i<<=1)e|=e>>i;return e+1}var M=null;pe.deduplicate=function(e,i,r,o,a){r===void 0&&(r=0),o===void 0&&(o=0),a===void 0&&(a=e.byteLength/(4*i)),e=new Uint32Array(e,o,a*i),o=new Uint32Array(a);var n=Math.floor(1.1*a)+1;(M==null||M.length<2*n)&&(M=new Uint32Array(Oe(2*n)));for(var t=0;t<2*n;t++)M[t]=0;for(var f=0,u=r!==0?Math.ceil(7.84*1.96/(r*r)*r*(1-r)):a,t=0;t<a;t++){if(t===u){var s=1-f/t;if(s+1.96*Math.sqrt(s*(1-s)/t)<r)return null;u*=2}for(var s=t*i,y,x=y=0;x<i;x++)y=e[s+x]+y|0,y=y+(y<<11)+(y>>>2)|0;y>>>=0;for(var x=y%n,p=f;M[2*x+1]!==0;){if(M[2*x]===y){var h=M[2*x+1]-1,l=h*i;e:{for(var m=0;m<i;m++)if(e[s+m]!==e[l+m]){l=!1;break e}l=!0}if(l){p=o[h];break}}x++,x>=n&&(x-=n)}p===f&&(M[2*x]=y,M[2*x+1]=t+1,f++),o[t]=p}if(r!==0&&1-f/a<r)return null;for(r=new Uint32Array(i*f),t=f=0;t<a;t++)if(o[t]===f){for(n=e,u=t*i,s=r,y=f*i,x=i,p=0;p<x;p++)s[y+p]=n[u+p];f++}return{buffer:r.buffer,indices:o,uniqueCount:f}};var ne=pe;function Ie(){}function Ce(e){return Math.acos(1<e?1:-1>e?-1:e)}function ze(e){var i=function(){var o=!![];return function(a,n){var t=o?function(){if(n){var f=n.apply(a,arguments);return n=null,f}}:function(){};return o=![],t}}(),r=i(this,function(){return r.toString().search("(((.+)+)+)+$").toString().constructor(r).search("(((.+)+)+)+$")});return r(),e*Math.PI/180}var Me=4,Ue=35,be=ze(Me),Ve=ze(Ue),qe=Math.cos(Ve),Ge=Math.cos(be);function We(e,i,r){var o=r.x-i.x,a=r.y-i.y;return i=r.z-i.z,r=o*o+a*a+i*i,r?(r=1/Math.sqrt(r),e.x=o*r,e.y=a*r,e.z=i*r,e):(e.x=0,e.y=0,e.z=0,e)}var Ye={position0:new c,position1:new c,faceNormal0:new c,faceNormal1:new c,cosAngle:0},Be=new c,we=new c;function ke(e,i){var r=Ce(e.cosAngle);We(we,e.position1,e.position0),c.cross(e.faceNormal0,e.faceNormal1,Be);var o=0<c.dot(Be,we)?-1:1;return r*o>i}function je(e){var i=e.faces.length/3,r=e.faces,o=e.neighbors,a=0,n=0;for(n=0;n<i;n++){var t=o[3*n+0],f=o[3*n+1],u=o[3*n+2],s=r[3*n+0],y=r[3*n+1],x=r[3*n+2];a=a+(t===-1||s<y?1:0),a=a+(f===-1||y<x?1:0),a=a+(u===-1||x<s?1:0)}var p=new Int32Array(4*a),h=0;for(n=0;n<i;n++){var t=o[3*n+0],f=o[3*n+1],u=o[3*n+2],s=r[3*n+0],y=r[3*n+1],x=r[3*n+2];(t===-1||s<y)&&(p[h++]=s,p[h++]=y,p[h++]=n,p[h++]=t),(f===-1||y<x)&&(p[h++]=y,p[h++]=x,p[h++]=n,p[h++]=f),(u===-1||x<s)&&(p[h++]=x,p[h++]=s,p[h++]=n,p[h++]=u)}return p}var C=new c,j=new c,$=new c;function $e(e){var i=e.x*e.x+e.y*e.y+e.z*e.z;i>0&&(i=1/Math.sqrt(i),e.x*=i,e.y*=i,e.z*=i)}function Ze(e){for(var i=e.faces.length/3,r=e.vertices,o=e.dim,a=e.faces,n=new Float32Array(3*i),t=0;t<i;t++){var f=a[3*t+0],u=a[3*t+1],s=a[3*t+2];C.x=r[o*f],C.y=r[o*f+1],C.z=r[o*f+2],j.x=r[o*u],j.y=r[o*u+1],j.z=r[o*u+2],$.x=r[o*s],$.y=r[o*s+1],$.z=r[o*s+2],c.subtract(j,C,j),c.subtract($,C,$),c.cross(j,$,C),$e(C),n[3*t+0]=C.x,n[3*t+1]=C.y,n[3*t+2]=C.z}return n}function Je(e,i){i===0&&(i=e,e=0);for(var r=Array(i-e),o=e;o<i;o++)r[o-e]=o;return r}Ie.extractEdges=function(e,i){var r=e.vertices,o=e.dim,a=v(i),n=Ye,t=n.position0,f=n.position1,u=n.faceNormal0,s=n.faceNormal1,y=Ze(e),x=je(e),p=x.length/4,h=new Float32Array(10*p),l=0,m=new Float32Array(13*p),d=0,I=0,g=0,D=Je(0,p),A=new Float32Array(p);A.forEach(function(ve,J,Se){var fe=x[4*J+0],ue=x[4*J+1];t.x=r[fe*o],t.y=r[fe*o+1],t.z=r[fe*o+2],f.x=r[ue*o],f.y=r[ue*o+1],f.z=r[ue*o+2],Se[J]=c.distance(t,f)}),D.sort(function(ve,J){return A[J]-A[ve]});for(var T=[],B=[],O=0;O<p;O++){var V=D[O],W=A[V],_=x[4*V+0],oe=x[4*V+1],Y=x[4*V+2],ee=x[4*V+3],me=ee===-1;t.x=r[_*o],t.y=r[_*o+1],t.z=r[_*o+2],f.x=r[oe*o],f.y=r[oe*o+1],f.z=r[oe*o+2];var ae=-1;if(a&&(ae=i[_]),me)u.x=y[3*Y],u.y=y[3*Y+1],u.z=y[3*Y+2],s.x=u.x,s.y=u.y,s.z=u.z,n.cosAngle=c.dot(u,s);else if(u.x=y[3*Y],u.y=y[3*Y+1],u.z=y[3*Y+2],s.x=y[3*ee],s.y=y[3*ee+1],s.z=y[3*ee+2],n.cosAngle=c.dot(u,s),n.cosAngle>Ge)continue;I+=W,g++,me||n.cosAngle<qe?(h[l++]=n.position0.x,h[l++]=n.position0.y,h[l++]=n.position0.z,h[l++]=n.position1.x,h[l++]=n.position1.y,h[l++]=n.position1.z,h[l++]=n.faceNormal0.x,h[l++]=n.faceNormal0.y,h[l++]=n.faceNormal0.z,h[l++]=ae,T.push(W)):ke(n,be)&&(m[d++]=n.position0.x,m[d++]=n.position0.y,m[d++]=n.position0.z,m[d++]=n.position1.x,m[d++]=n.position1.y,m[d++]=n.position1.z,m[d++]=n.faceNormal0.x,m[d++]=n.faceNormal0.y,m[d++]=n.faceNormal0.z,m[d++]=n.faceNormal1.x,m[d++]=n.faceNormal1.y,m[d++]=n.faceNormal1.z,m[d++]=ae,B.push(W))}h=h.slice(0,l),m=m.slice(0,d);var se=I/g,le=T.length,de=B.length;return{regular:{instancesData:h,instanceCount:le,edgeLength:le*se},silhouette:{instancesData:m,instanceCount:de,edgeLength:de*se},averageEdgeLength:se}};var De=Ie;var He=function(){var e=!![];return function(i,r){var o=e?function(){if(r){var a=r.apply(i,arguments);return r=null,a}}:function(){};return e=![],o}}(),he=He(void 0,function(){return he.toString().search("(((.+)+)+)+$").toString().constructor(he).search("(((.+)+)+)+$")});he();function S(e){}S.RegularInstanceStride=12,S.SilhouetteInstanceStride=15,S.createEdgeData=function(e,i,t,o){if(i.length==0)return null;var a=i[0],n;a.indexType===0?n=new Uint16Array(a.indicesTypedArray.buffer,a.indicesTypedArray.byteOffset,a.indicesTypedArray.byteLength/2):n=new Uint32Array(a.indicesTypedArray.buffer,a.indicesTypedArray.byteOffset,a.indicesTypedArray.byteLength/4);var t=R(t,![]),f=S.extractEdgeInformation(e,t,n),u=e.attrLocation.batchId,s=null;u&&(s=e.vertexAttributes[u].typedArray);var y=De.extractEdges(f,s);return v(o)&&(v(y.regular.instancesData)&&o.push(y.regular.instancesData.buffer),v(y.silhouette.instancesData)&&o.push(y.silhouette.instancesData.buffer)),y},S.createIndexBuffer=function(e,i){return e.createSidenessIndexBuffer()},S.createRegularEdgeAttributes=function(e,i,r,o){if(!(!v(i.instancesData)||i.instancesData.length==0)){var a={},n=[];i.attributeLocations=a,i.attributes=n;var t=xe.createVertexBuffer({context:e,typedArray:i.instancesData,usage:K.STATIC_DRAW,owner:o});i.instancesData=null;var f=z.getSizeInBytes(z.FLOAT),u=e.createSidenessVertexBuffer(),s=0;a.aSideness=s++,n.push({name:"aSideness",index:a.aSideness,vertexBuffer:u,componentsPerAttribute:2,componentDatatype:z.FLOAT,offsetInBytes:0,strideInBytes:z.getSizeInBytes(z.FLOAT)*2,normalize:![]});var y=r||S.RegularInstanceStride,x=0;a.aPosition0=s++,n.push({name:"aPosition0",index:a.aPosition0,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:![],offsetInBytes:f*x,strideInBytes:f*y,instanceDivisor:1}),x+=3,a.aPosition1=s++,n.push({name:"aPosition1",index:a.aPosition1,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:![],offsetInBytes:f*x,strideInBytes:f*y,instanceDivisor:1}),x+=3,a.aNormal=s++,n.push({name:"aNormal",index:a.aNormal,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:f*x,strideInBytes:f*y,instanceDivisor:1}),x+=3,a.batchId=s++,n.push({name:"batchId",index:a.batchId,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:f*x,strideInBytes:f*y,instanceDivisor:1}),x+=1,a.aVariantStroke=s++,n.push({name:"aVariantStroke",index:a.aVariantStroke,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:f*x,strideInBytes:f*y,instanceDivisor:1}),x+=1,a.aVariantExtension=s++,n.push({name:"aVariantExtension",index:a.aVariantExtension,vertexBuffer:t,componentsPerAttribute:1,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:f*x,strideInBytes:f*y,instanceDivisor:1}),x+=1}},S.createSilhouetteEdgeAttributes=function(e,i,r){if(!(!v(i.instancesData)||i.instancesData.length==0)){var o={},a=[];i.attributeLocations=o,i.attributes=a;var n=xe.createVertexBuffer({context:e,typedArray:i.instancesData,usage:K.STATIC_DRAW,owner:r});i.instancesData=null;var t=z.getSizeInBytes(z.FLOAT),f=0;o.aSideness=f++,a.push({name:"aSideness",index:o.aSideness,vertexBuffer:e.createSidenessVertexBuffer(),componentsPerAttribute:2,componentDatatype:z.FLOAT,offsetInBytes:0,strideInBytes:t*2,normalize:![]});var u=S.SilhouetteInstanceStride,s=0;o.aPosition0=f++,a.push({name:"aPosition0",index:o.aPosition0,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=3,o.aPosition1=f++,a.push({name:"aPosition1",index:o.aPosition1,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=3,o.aNormalA=f++,a.push({name:"aNormalA",index:o.aNormalA,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=3,o.aNormalB=f++,a.push({name:"aNormalB",index:o.aNormalB,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=3,o.batchId=f++,a.push({name:"batchId",index:o.batchId,vertexBuffer:n,componentsPerAttribute:1,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=1,o.aVariantStroke=f++,a.push({name:"aVariantStroke",index:o.aVariantStroke,vertexBuffer:n,componentsPerAttribute:1,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=1,o.aVariantExtension=f++,a.push({name:"aVariantExtension",index:o.aVariantExtension,vertexBuffer:n,componentsPerAttribute:1,componentDatatype:z.FLOAT,normalize:!![],offsetInBytes:t*s,strideInBytes:t*u,instanceDivisor:1}),s+=1}};function Le(e,i){for(var r=i.componentsPerAttribute,o=e.vertCompressConstant,a=new c(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),n=new Uint16Array(i.typedArray.buffer,i.typedArray.byteOffset,i.typedArray.byteLength/2),t=new Float32Array(e.verticesCount*3),f,u,s,y=0;y<e.verticesCount;y++)f=n[r*y]*o+a.x,u=n[r*y+1]*o+a.y,s=n[r*y+2]*o+a.z,t[3*y]=f,t[3*y+1]=u,t[3*y+2]=s;return t}S.extractEdgeInformation=function(e,i,r){var o=e.attrLocation.aPosition,a=e.vertexAttributes[o],n=v(e.nCompressOptions)&&(e.nCompressOptions&H.SVC_Vertex)===H.SVC_Vertex,t=a.componentsPerAttribute,f;n?(t=3,f=Le(e,a)):f=new Float32Array(a.typedArray.buffer,a.typedArray.byteOffset,a.typedArray.byteLength/4);var u=f.length/t;if(i&&r){var s=ne.computeNeighbors(r,u);return{faces:r,neighbors:s,vertices:f,dim:t}}var y=a.typedArray.buffer,x;n?x=f.buffer:x=y.slice(a.typedArray.byteOffset,a.typedArray.byteOffset+a.typedArray.byteLength);var p=ne.deduplicate(x,t),h=S.selectIndexData(p.indices,r),l=ne.computeNeighbors(h,p.uniqueCount),m=new Float32Array(p.buffer);return{faces:h,neighbors:l,vertices:m,dim:t}},S.selectIndexData=function(e,i){if(i){i=i.slice();for(var r=0;r<i.length;r++)i[r]=e[i[r]];return i}return e};var b=new c,E=new c,G=new c,Z=new c,L=new c,ie=new c,U=new c,Te=new c;S.createEdgeDataByIndices=function(e,i){var r=e.attrLocation.aPosition,o=e.vertexAttributes[r],a=v(e.nCompressOptions)&&(e.nCompressOptions&H.SVC_Vertex)===H.SVC_Vertex,n=o.componentsPerAttribute,t;a?(n=3,t=Le(e,o)):t=new Float32Array(o.typedArray.buffer,o.typedArray.byteOffset,o.typedArray.byteLength/4);var f;i.indexType===0?f=new Uint16Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/2):f=new Uint32Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/4);for(var u=[],s=[],y=f.length,x=0,p=0,h=Math.floor(y/4)*4;p<h;p+=4){var l=f[p],m=f[p+1],d=f[p+2],I=f[p+3];if(b.x=t[n*l],b.y=t[n*l+1],b.z=t[n*l+2],E.x=t[n*m],E.y=t[n*m+1],E.z=t[n*m+2],G.x=t[n*d],G.y=t[n*d+1],G.z=t[n*d+2],Z.x=t[n*I],Z.y=t[n*I+1],Z.z=t[n*I+2],!(c.equals(E,G)||c.equals(E,Z)||c.equals(E,b)||c.equals(G,b)||c.equals(Z,b))){if(d===I){if(c.subtract(E,b,L),c.subtract(G,b,ie),c.cross(L,ie,L),c.equals(L,c.ZERO))continue;c.normalize(L,L),u.push(b.x),u.push(b.y),u.push(b.z),u.push(E.x),u.push(E.y),u.push(E.z),u.push(L.x),u.push(L.y),u.push(L.z),u.push(l);var g=Ee(b,E),D=g.variantStroke,A=g.variantExtension;u.push(D),u.push(A)}else{if(c.subtract(E,b,L),c.subtract(G,b,ie),c.cross(L,ie,L),c.equals(L,c.ZERO)||(c.normalize(L,L),c.subtract(E,b,U),c.subtract(Z,b,Te),c.cross(Te,U,U),c.equals(U,c.ZERO)))continue;c.normalize(U,U),s.push(b.x),s.push(b.y),s.push(b.z),s.push(E.x),s.push(E.y),s.push(E.z),s.push(L.x),s.push(L.y),s.push(L.z),s.push(U.x),s.push(U.y),s.push(U.z),s.push(l);var g=Ee(b,E),D=g.variantStroke,A=g.variantExtension;s.push(D),s.push(A)}var T=c.distance(b,E);x+=T}}var B=y/4,O=x/B,V=u.length/S.RegularInstanceStride,W=s.length/S.SilhouetteInstanceStride;return{regular:{instancesData:new Float32Array(u),instanceCount:V,edgeLength:V*O},silhouette:{instancesData:new Float32Array(s),instanceCount:W,edgeLength:W},averageEdgeLength:O}};function Ee(e,i){function r(h,l){var m=new Float32Array(6),d=new Uint32Array(m.buffer),I=new Uint32Array(1);m[0]=h.x,m[1]=h.y,m[2]=h.z,m[3]=l.x,m[4]=l.y,m[5]=l.z,I[0]=5381;for(var g=0;g<d.length;g++)I[0]=31*I[0]+d[g];return I[0]}function o(h,l,m){m-=l;var d=48217*h%2147483647,I=d/2147483647,g=l+I*m;return{seed:d,result:Math.round(g)}}function a(h){var l=48217*h%2147483647,m=l/(2147483647-1);return{seed:l,result:m}}var n=r(e,i);!v(n)&&(n=Math.random()*2147483647);var t=o(n,0,255);n=t.seed;var f=t.result;t=o(n,0,5),n=t.seed;var u=t.result;t=a(n),n=t.seed;var s=t.result;s=-(1-Math.min(s/.7,1))+Math.max(0,s-.7)/(1-.7),s=255*(Math.abs(s)**1.2*(0>s?-1:1)*.5+.5);var y=f,x=u,p=s;return{variantStroke:x,variantExtension:p}}var Ct=S;export{Ct as a};
